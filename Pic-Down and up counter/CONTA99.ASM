	LIST	P=16F84

PCL	EQU	02H
PA	EQU	05H
TRISA	EQU	05H
PB	EQU	06H
TRISB	EQU	06H
STATUS	EQU	03H
UNI	EQU	10H
DEC	EQU	11H
PRESS	EQU	12H
RETAR	EQU	13H


	ORG	0
	BSF	STATUS,5	;CAMBIO AL BANCO DE MEMORIA 1
	CLRF	TRISB		;PONGO A 0 EL REGISTRO TRISB Y EL PUERTO B QUEDA COMO SALIDA
	MOVLW	B'11111100'	;MUEVO 1111100 A W PARA COLOCAR UNICAMENTE LOS DOS PRIMEROS PINES DE PA COMO SALIDA
	MOVWF	TRISA		;CONFIGURO EL PA COMO (IIIIIIOO)
	BCF	STATUS,5	;ME CAMBIO AL BANCO DE MEMORIA 0

	CLRF	PA		;BORRA PUERTO A
	CLRF	UNI		;BORRA LAS UNIDADES DEL CONTADOR
	CLRF	DEC		;BORRA LAS DECENAS DEL CONTADOR
	CLRF	PRESS		;BORRA LA VARIABLE QUE DETECTA SI EL BOTON ESTA PRESIONADO

INICIO	CALL	MOSTRAR		;LLAMA A LA RUTINA DE MOSTRAR EN EL DISPLAY
	CALL	CONTAR		;LLAMA A LA RUTINA DE CONTAR
	GOTO	INICIO		;RETORNA A INICIO
	
CONTAR	BTFSS	PA,2		;VERIFICA SI ESTA PRESIONADO EL BOTON
	GOTO	SUM		;EL BOTON VALE 0 Y ESTA PRESIONADO
	BTFSS	PA,3		;VERIFICA SI ESTA PRESIONADO EL BOTON
	GOTO	DIS		;EL BOTON VALE 0 Y ESTA PRESIONADO
	BCF	PRESS,0		;NO ESTA PRESIONADO EL BOTON Y COLOCA A 0 LA VARIABLE PRESS A 0
	RETURN			;SALE DE LA SUBRUTINA
SUM	BTFSC	PRESS,0		;VERIFICA SI PRESS ES IGUAL A 0
	RETURN			;COMO PRESS ES IGUAL A 1 ENTONCES EL BOTON NO A SIDO SOLTADO
	BSF	PRESS,0		;SE ACABA DE PRESIONAR EL BOTON Y SE CAMBIA LA VARIABLE PRESS A 1
	INCF	UNI,1		;UNI=UNI+1
	MOVF	UNI,0		;SE MUEVE EL VALOR DE UNI A W
	SUBLW	D'10'		;SE LE RESTA EL NUMERO 10 
	BTFSS	STATUS,2	;SE VERIFICA LA BANDERA DE Z PARA SABER SI LA RESTA DIO 0 
	RETURN			;LA RESTA NO DA CERO POR LO CUAL ES MENOR A 10 Y SALIMOS DE LA RUTINA
	CLRF	UNI		;COMO LA RESTA ES 0 LA VARIABLE UNI ES 10, POR LO CUAL SE LLEVA A 0
	INCF	DEC,1		;DEC=DEC+1
	MOVF	DEC,0		;SE MUEVE EL VALOR DE DEC A W
	SUBLW	D'10'		;SE LE RESTA EL NUMERO 10 A W
	BTFSS	STATUS,2	;SE VERIFICA LA BANDERA DE Z PARA SABER SI LA RESTA DIO 0
	RETURN			;COMO LA RESTA NO DA CERO DEC ES MENOR QUE 10 Y SALIMOS DE LA RUTINA
	CLRF	DEC		;COMO DEC ES IGUAL A 10 ENTONCES LA BORRAMOS
	RETURN			;SALIMO DE LA RUTINA
DIS	BTFSC	PRESS,0			;VERIFICA SI PRESS ES IGUAL A 0
	RETURN							;COMO PRESS ES IGUAL A 1 ENTONCES EL BOTON NO A SIDO SOLTADO
	BSF	PRESS,0					;SE ACABA DE PRESIONAR EL BOTON Y SE CAMBIA LA VARIABLE PRESS A 1
	MOVF	UNI,0					;MUEVE UNI A W
	SUBLW	0							;RESTA W(UNI) - 0 Y SI RETORNA 0 GUARDA 1 EN Z
	BTFSS	STATUS,2			;SI Z ES DISTINTO A 0 SALTA LA LINEA SIGUIENTE	
	DECF	UNI,1					;COMO Z ES IGUAL A 0, OSEA W(UNI) ES DISTINTO A 0 SE LE RESTA 1
	SUBLW	0							;RESTA W(UNI) - 0 Y SI RETORNA 0 GUARDA 1 EN Z
	BTFSC	STATUS,2			;SI Z ES IGUAL A 0 SALTA LA LINEA SIGUIENTE
	GOTO DISDEC					;LLAMA LA RUTINA DISDEC
	RETURN							;SALE DE LA RUTINA
DISDEC MOVF	DEC,0			;MUEVE DEC A W
	SUBLW	0							;RESTA W(DEC) - 0 Y SI RETORNA 0 GUARDA 1 EN Z
	BTFSC	STATUS,2			;SI Z ES IGUAL A 0 SALTA LA LINEA SIGUIENTE
	RETURN        			;SALE DE LA RUTINA
	DECF	DEC,1					;COMO Z ES IGUAL A 0, OSEA W(DEC) ES DISTINTO A 0 SE LE RESTA 1
	INCF	UNI,1					;UNI=1		\
	INCF	UNI,1					;UNI=2		 \
	INCF	UNI,1					;UNI=3			\
	INCF	UNI,1					;UNI=4			 \
	INCF	UNI,1					;UNI=5 				NO SUPE ASIGNAR 9 SIN QUE FALLARA!
	INCF	UNI,1					;UNI=6			 /
	INCF	UNI,1					;UNI=7			/
	INCF	UNI,1					;UNI=8		 /
	INCF	UNI,1					;UNI=9		/
	RETURN							;SALE DE LA RUTINA

MOSTRAR	MOVF	UNI,0		;SE MUEVE EL VALOR DE LA UNI A W
	CALL	CONVERT		;SE LLAMA A LA RUTINA DE CONVERT
	MOVWF	PB		;SE MUEVE EL VALOR QUE TRAE W A PB
	BSF	PA,0		;SE ACTIVA EL PRIMER DISPLAY 
	CALL	RETARDO		;SE LLAMA A LA RUTINA DE RETARDO
	BCF	PA,0		;SE APAGA EL PRIMER DISPLAY
	MOVF	DEC,0		;SE MUEVE EL VALOR DE DEC A W
	CALL	CONVERT		;SE LLAMA A LA RUTINA DE CONVERT
	MOVWF	PB		;SE MUEVE EL VALOR QUE TRAE W A PB
	BSF	PA,1		;SE ACTIVA EL SEGUNDO DISPLAY
	CALL	RETARDO		;SE LLAMA A LA RUTINA DE RETARDO
	BCF	PA,1		;SE APAGA EL SEGUNDO DISPLAY
	RETURN			;SALIMOS DE LA RUTINA

CONVERT	ADDWF	PCL,1		;SE LE SUMA EL VALOR DE W AL APUNTADOR DE PROGRAMA PARA DE DEVUELVA EL VALOR EN 7 SEGMENTOS
	RETLW	B'11000000'	;EL VALOR DE W ES IGUAL A 0 Y SE DEVUELVE EL CODIGO 7 SEGMENTOS DE 0 A W Y SE SALE DE LA RUTINA	
	RETLW	B'11111001'	;EL VALOR DE W ES IGUAL A 1 Y SE DEVUELVE EL CODIGO 7 SEGMENTOS DE 1 A W Y SE SALE DE LA RUTINA
	RETLW	B'10100100'	;EL VALOR DE W ES IGUAL A 2 Y SE DEVUELVE EL CODIGO 7 SEGMENTOS DE 2 A W Y SE SALE DE LA RUTINA
	RETLW	B'10110000'	;EL VALOR DE W ES IGUAL A 3 Y SE DEVUELVE EL CODIGO 7 SEGMENTOS DE 3 A W Y SE SALE DE LA RUTINA
	RETLW	B'10011001'	;EL VALOR DE W ES IGUAL A 4 Y SE DEVUELVE EL CODIGO 7 SEGMENTOS DE 4 A W Y SE SALE DE LA RUTINA
	RETLW	B'10010010'	;EL VALOR DE W ES IGUAL A 5 Y SE DEVUELVE EL CODIGO 7 SEGMENTOS DE 5 A W Y SE SALE DE LA RUTINA
	RETLW	B'10000010'	;EL VALOR DE W ES IGUAL A 6 Y SE DEVUELVE EL CODIGO 7 SEGMENTOS DE 6 A W Y SE SALE DE LA RUTINA
	RETLW	B'11111000'	;EL VALOR DE W ES IGUAL A 7 Y SE DEVUELVE EL CODIGO 7 SEGMENTOS DE 7 A W Y SE SALE DE LA RUTINA
	RETLW	B'10000000'	;EL VALOR DE W ES IGUAL A 8 Y SE DEVUELVE EL CODIGO 7 SEGMENTOS DE 8 A W Y SE SALE DE LA RUTINA
	RETLW	B'10011000'	;EL VALOR DE W ES IGUAL A 9 Y SE DEVUELVE EL CODIGO 7 SEGMENTOS DE 9 A W Y SE SALE DE LA RUTINA

RETARDO	MOVLW	H'FF'		;SE LE ASIGNA EL VALOR DE 255 A W
	MOVWF	RETAR		;SE LE ASIGNA EL VALOR DE 255 A RETAR
A1	DECFSZ	RETAR,1		;RETAR=RETAR-1 Y SI LA RESTA DA CERO SALTA UNA LINEA
	GOTO	A1		;LA RESTA NO DIO 0
	RETURN			;LA RESTA DIO 0 Y SALIMOS DE LA RUTINA

	END